<!DOCTYPE html>
<html>
    <head>
        <title>PRODUCT : Rapture Getting Started: Reflex</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            PRODUCT : Rapture Getting Started: Reflex
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">







            Created by <span class='author'> Andrew Clark</span>, last modified by <span class='editor'> Jonathan Major</span> on Feb 25, 2016
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="contentLayout2">
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h1 id="RaptureGettingStarted:Reflex-Tutorial1:YourfirstRaptureReflexProject.">Tutorial 1: Your first Rapture Reflex Project.  </h1><p>This tutorial will cover uploading files, translating into documents, updating series data, and running reports using Rapture platforms scripting language Reflex.<br/><br/></p><p><strong style="font-size: 20.0px;line-height: 1.5;">Options for running Reflex</strong></p><p>Running this tutorial requires access to a running Rapture instance. See <a href="http://rapture+getting+started+guide/#GetDemoEnv" class="external-link" rel="nofollow">Rapture Getting Started Guide</a></p><p>Reflex is a scripting language, and as such requires an interpreter. There are three ways to execute scripts:</p><ol><li><p>RIM demo environment: Script Execution Window</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">RIM Script Page</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-1818335481" class="expand-container"><div id="expander-control-1818335481" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to find out about Script window</span></div><div id="expander-content-1818335481" class="expand-content"><p> </p></div></div></div></div></li><li><p>RIM demo environment: Reflex REPL Window</p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">RIM REPL Page</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-755695092" class="expand-container"><div id="expander-control-755695092" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to find out about REPL window</span></div><div id="expander-content-755695092" class="expand-content"><p>RIM comes with a REPL page for Reflex scripts. </p><p>Login and click on the &gt;_ icon. </p><p>This will bring up the Reflex REPL window; users can type commands directly into the browser and they will be executed immediately.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/71630884/71631046.png" data-image-src="attachments/71630884/71631046.png" data-unresolved-comment-count="0" data-linked-resource-id="71631046" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2016-2-4 17:22:5.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></p></div></div></div></div><p><span><br/></span></p></li><li><p><span><span>Local: ReflexRunner client utility </span></span></p><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Use of ReflexRunner</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-1080679878" class="expand-container"><div id="expander-control-1080679878" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to find out about ReflexRunner app</span></div><div id="expander-content-1080679878" class="expand-content"><p style="margin-left: 30.0px;">The tutorial bundle includes ReflexRunner, a Java interpreter that will read and execute a reflex script from a file. This document will focus on running the tutorial scripts using ReflexRunner. </p><p style="margin-left: 30.0px;"><em>Connecting to Rapture</em>: To log in to the Rapture environment via ReflexRunner the user must specify a user name, a password and the location (URL) of the Rapture instance to connect to. This can be done using command line options or environmental variables.</p><p style="margin-left: 30.0px;">The tutorial includes a script called $RAPTURE_HOME/<span style="color: rgb(44,45,48);">Setup/</span>rapture.sh - <strong>if this script has already been executed then the following environmental variables will have been set and the command line options will not be needed</strong>. For reference:</p><p style="margin-left: 60.0px;">The environment can be specified using the -r option, or by setting the RAPTURE_HOME environmental variable. In most cases this will take the form http://<strong><em>envname</em></strong>.<a href="http://incapture.net/" class="external-link" rel="nofollow">incapture.net</a>:8665/rapture</p><p style="margin-left: 60.0px;">The username can be entered manually or specified with the -u option, or by setting the RAPTURE_USER environmental variable. Typically all users will have their own personal accounts; there is also a common 'rapture' account.</p><p style="margin-left: 60.0px;">The password can also be entered manually or specified with the -p option, or by setting the RAPTURE_PASSWORD environmental variable. Obviously in a real world instance for security purposes manual entry is recommended, but for the purposes of a tutorial this is supported.</p><p style="margin-left: 30.0px;"><em>Executing a script</em>: The script must be specified using the -f option; there is no command line or environmental alternative. So to run the App.rfx script using the default options:</p><pre style="margin-left: 30.0px;">$ ReflexRunner -f App.rfx</pre></div></div></div></div></li></ol><p><span>This document will focus on running the tutorial scripts using ReflexRunner.</span></p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><p> </p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Before beginning this demonstration of Rapture it is expected that your environment satisfies the following pre-requisites</p><ol><li>Java 8 (or later) runtime is installed and accessible<br/><br/></li></ol></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Reflex</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Reflex is a scripting language developed at Incapture Technologies. It is designed for performing cloud-based data manipulation. Reflex takes very little resource overhead, and therefore handles the data interactions more efficiently than JRuby, Jython, or any other standard scripting tool. We will demonstrate how to perform various operations using Reflex; for those interested in learning more, please check out the <a href="attachments/71630884/71630872.pdf" data-linked-resource-id="71630872" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Reflex Language Reference_v1pt10.pdf" data-nice-type="PDF Document" data-linked-resource-content-type="application/pdf" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53">Reflex Language Reference</a>.  </p></div></div></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h2 id="RaptureGettingStarted:Reflex-1.CreatenewRepositoriestostorethedata.">1. Create new Repositories to store the data.</h2><p><span> The first step in this tutorial is to login to your RIM instance and create the data repositories.</span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Process</p></th><th class="confluenceTh"> </th><th class="confluenceTh"> </th></tr><tr><td colspan="3" class="confluenceTd"><p>Login to your demo environment using url and credentials provided during signup</p></td></tr><tr><td colspan="1" class="confluenceTd">Create a Document repository using RIM's <strong><em>+ Add</em></strong> Repositories interface:<ol><li>Set <strong>Name</strong> to <em>tutorialDoc</em></li><li>Set <strong>Type</strong> to <em>Document</em></li><li>Set <strong>Data System</strong> to <em>MongoDB</em></li><li>Press the <strong>OK</strong> Button</li></ol></td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="248" src="attachments/71630884/74416148.png" data-image-src="attachments/71630884/74416148.png" data-unresolved-comment-count="0" data-linked-resource-id="74416148" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-02-05 at 11.19.16 AM.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></td></tr><tr><td colspan="1" class="confluenceTd">if not already added create a Blob repository again using RIM's <strong><em>+ Add</em> </strong>Repositories interface:<ol><li>Set <strong>Name</strong> to <em>tutorialBlob</em></li><li>Set <strong>Type</strong> to <em>Blob</em></li><li>Set <strong>Data System</strong> to <em>MongoDB</em></li><li>Press the <strong>OK</strong> Button</li></ol></td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/71630884/71631030.png" data-image-src="attachments/71630884/71631030.png" data-unresolved-comment-count="0" data-linked-resource-id="71631030" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2016-2-4 13:40:21.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></td></tr><tr><td colspan="3" class="confluenceTd">With the two repositories in place we are ready to move onto the next step in the tutorial: upload a CSV file.</td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Under the Hood</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-1990470311" class="expand-container"><div id="expander-control-1990470311" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to see Reflex that creates repositories</span></div><div id="expander-content-1990470311" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Eclipse" data-theme="Eclipse">SERIES_AUTHORITY=&quot;datacapture&quot;;
BLOB_AUTHORITY=&quot;tutorialBlob&quot;;
DOC_AUTHORITY=&quot;tutorialDoc&quot;;
BLOB_URI=&quot;blob://&quot;+BLOB_AUTHORITY;
DOC_URI=&quot;document://&quot;+DOC_AUTHORITY;
SERIES_URI=&quot;series://&quot;+SERIES_AUTHORITY;
if (!#blob.blobRepoExists(BLOB_URI)) do
     #blob.createBlobRepo(BLOB_URI, &quot;BLOB {} USING MONGODB {prefix=\&quot;&quot;+BLOB_AUTHORITY+&quot;\&quot; }&quot;, &quot;REP {} USING MONGODB { prefix=\&quot;&quot;+BLOB_AUTHORITY+&quot;\&quot;}&quot;);
end
if (!#doc.docRepoExists(DOC_URI)) do
     #doc.createDocRepo(DOC_URI, &quot;REP {} USING MONGODB {prefix=\&quot;&quot;+DOC_AUTHORITY+&quot;\&quot;}&quot;);
end
if (!#series.seriesRepoExists(SERIES_URI)) do
     #series.createSeriesRepo(SERIES_URI, &quot;SREP {} USING MONGODB {prefix=\&quot;&quot;+SERIES_AUTHORITY+&quot;\&quot;}&quot;);
end</pre>
</div></div></div></div></div></div><p> </p><p> </p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><p> </p><p style="text-align: right;"> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h2 id="RaptureGettingStarted:Reflex-2.CaptureData–LoadaCSV">2. Capture Data – Load a CSV</h2><p><span>In folder $RAPTURE_HOME/Intro01/Reflex/src/main run </span><span>the script </span>Upload.rfx using ReflexRunner </p><div
        id="getcode"                style="color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;"              >
    <pre>$ <span>cd $RAPTURE_HOME/Intro01/Reflex/src/main</span></pre><pre>$ ReflexRunner -f Upload.rfx</pre>
</div>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Under the Hood</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-1653731847" class="expand-container"><div id="expander-control-1653731847" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to see what&#39;s going on under the hood...</span></div><div id="expander-content-1653731847" class="expand-content"><p>The script will attempt to read a data file and store it in the blob repository. <br/>The accompanying data file <em><strong>introDataInbound.csv</strong></em> should be in the current working directory. </p><p>To read a different file, or to read from a different directory, set the environmental variable RAPTURE_TUTORIAL_CSV appropriately.</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>When using the REPL window or Script UI, Reflex cannot access the local file system. In order to upload data into Rapture a blob uploader is available from the user interface. To use this, create a Blob repository using the [+] icon at the top level if one does not already exist. Then select the repository using the Content Browser and select the [+] icon to upload a blob.</p></div></div><p><span style="color: rgb(255,0,0);"><strong>TBD if Script UI will be ready.</strong></span></p><p>The following Reflex code defines a file with name CSV_FILE. <br/>The file operation may take additional parameters to indicate the file type; these include </p><ul><li>CSV - Comma separated values. Each line is a series of values separated by a delimiter. The default delimiter is a comma; an alternate delimiter can be specified as a further argument. The data will be returned as a list of lists.</li><li>CSVHEADER - Comma separated values with separate header. In this case the first line is treated as a list of column headers and kept separate from the rest of the data. As with CSV a different delimiter can be specified. The data will be returned as a list of maps</li><li>JSONDOC - The data is a single JSON formatted document. The data will be returned as a single map.</li><li>JSONARRAY - The data is a list of JSON formatted documents, one per line. The data will be returned as a list of maps.</li></ul><p>Unrecognized data types will be stored with the mine-type text/plain.</p><p>The --&gt; operator, known as &quot;push&quot;, takes the data from the file and inserts it directly into the Blob Repository. <br/>The blob metadata will hold the type information as well as the time and identity of the uploader. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Eclipse" data-theme="Eclipse">CSV_FILE = ENV.RAPTURE_TUTORIAL_CSV;

if (CSV_FILE == null) do
   CSV_FILE = &quot;introDataInbound.csv&quot;;
   println(&quot;No CSV specified. Defaulting to &quot;+CSV_FILE);
end
rawCsvUri = BLOB_URI+&quot;/&quot;+CSV_FILE;
if (!#blob.blobExists(rawCsvUri)) do
   println(&quot;Reading CSV from file &quot; + CSV_FILE);
   file(CSV_FILE, &quot;CSV&quot;) --&gt; rawCsvUri;
   println(&quot;CSV uploaded to &quot;+ rawCsvUri);
else do
   println(&quot;Data has already been uploaded to the BLOB repository.&quot;);
end
println(&quot;\nDone\n&quot;);</pre>
</div></div></div></div></div></div><p> </p><p>At this point we have uploaded the CSV file into the <a href="blob://tutorialBlob repository" rel="nofollow">blob://tutorialBlob repository</a>. </p><p>Look at the <a href="https://github.com/Incapture/RaptureTutorials/blob/master/Intro01/Reflex/src/main/Upload.rfx" class="external-link" rel="nofollow">Upload.rfx</a>() in the RaptureTutorials project to see the API calls used.</p><p>Look at the RIM interface to see the blob you uploaded:</p><p style="margin-left: 30.0px;"><span style="color: rgb(255,0,0);"><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="250" width="444" src="attachments/71630884/74416199.png" data-image-src="attachments/71630884/74416199.png" data-unresolved-comment-count="0" data-linked-resource-id="74416199" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-02-19 at 11.52.32 AM.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></span><br/></strong></span></p><p><span style="color: rgb(0,0,0);">Next up we will run code to translate the CSV file (in the blob repo) to a document (in the document repo).</span></p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">In this step</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Run upload script to load CSV into Blob</p><p>View Blob</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Reflex</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">ReflexRunner has been added to your path</div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Windows users</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Use %RAPTURE_HOME% if needed</p></div></div></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h2 id="RaptureGettingStarted:Reflex-3.TranslateData–CreatedocumentsfromrawData">3. Translate Data – Create documents from raw Data</h2><p>Again in the same folder <span>$RAPTURE_HOME/Intro01/Reflex/src/main</span> run the script BlobToDoc.rfx</p><div
        id="getcode"                style="color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;"              >
    <pre>$ ReflexRunner -f BlobToDoc.rfx</pre>
</div>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Under the Hood</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-1254160884" class="expand-container"><div id="expander-control-1254160884" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to see what&#39;s going on under the hood...</span></div><div id="expander-content-1254160884" class="expand-content"><p>Having loaded the data into Rapture the next step is to convert it into a usable format.</p><p>One option is to use the Pull operator which will interpret the data according to its metadata type. In the case of a CSV, Reflex will split the data into a List of Lists.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Eclipse" data-theme="Eclipse">data &lt;-- rawCsvUri;</pre>
</div></div><p>Another option is to open the blob using the file command and read it as raw text, one line at a time, then parse it accordingly. The split command will break each line into individual columns based on the separator string; the boolean argument indicates whether to ignore the separator if it occurs within quotation marks.</p><p>When using file to read a blob it is not necessary to specify the file type since this information is already stored as metadata. However the information can be supplied or overridden if so desired. </p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">data = [];
for datum in file(rawCsvUri) do
  if datum == null do
    println(&quot;Nothing found at &quot; + rawCsvUri + &quot;. Please run step &#39;upload&#39; to add the CSV to Rapture.&quot;);
    // Reflex doesn&#39;t have an exit operation but assert(false) is the nearest thing.
    assert(false);
   end
   data.add(split(datum, &quot;,&quot;, true));
end</pre>
</div></div><p>Having read the data, process it. In this instance the last column needs to be converted from a string to a number using the cast operation, and the date column has hyphens which must be removed using the replace operation.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">headers = data[0];
noheaders = data.subList(1, data.size());
for datum in noheaders do
    siz = datum.size();
    if (siz &gt;= 2) do
      key = datum[siz -2];
      datum[siz -2] = replace(key,&quot;-&quot;,&quot;&quot;);
      datum[siz -1] = cast(datum[siz -1], &#39;number&#39;);
  end
end</pre>
</div></div><p>The data can now be written to the Document repository. In Rapture a Document must be a JSON formatted Map.</p><p>Since the data is in a List of Lists it will need to be converted to a Map. Pushing the List data to the Document repository will automatically convert the data to a nested Map of Maps - every unique entry in the first column will become a Key and the remaining columns will become values. The data can thereafter be pulled from the document repository as a Map.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">noheaders --&gt; DOC_URI+&quot;/introDataTranslated&quot;;
 </pre>
</div></div><p>Alternatively the data can be written in an application-specific format, as long as it is a JSON compliant map. For this tutorial a format has been defined as described in the main document.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">dataMap = {};
indexMap = {};
firstEntry = noheaders[0];
for k in [ 0,1,3 ] do
  key = headers[k];
  val = firstEntry[k];
  dataMap[key] = val;
end

key = headers[2];
dataMap[key] = indexMap;

for datum in noheaders do
  if (size(datum) &gt; 4) do
    index = datum[2];
    priceType = datum[4];
    indexValMap = indexMap[index];
    if (indexValMap == null) do
      indexValMap = {};
      indexMap[index] = indexValMap;
    end
    priceTypeMap = indexValMap[priceType];
    if (priceTypeMap == null) do
      priceTypeMap = {};
      indexValMap[priceType] = priceTypeMap;
    end
    datestr = datum[5];
    val = cast(datum[6], &#39;number&#39;);
    priceTypeMap[datestr] = val;
  end
end
#doc.putDoc(DOC_URI+&quot;/introDataTranslated&quot;, json(dataMap));</pre>
</div></div></div></div></div></div><p>At this point the CSV (blob) data has been converted into a document type, which is in this repository: <a href="document://tutorialDoc/introDataTranslated" rel="nofollow">document://tutorialDoc/introDataTranslated</a></p><p>Look at the <a href="https://github.com/Incapture/RaptureTutorials/blob/master/Intro01/Reflex/src/main/BlobToDoc.rfx" class="external-link" rel="nofollow">BlobToDoc.rfx</a>() in the RaptureTutorials project to see the API calls used.</p><p>Look at the RIM interface to see the document you created.</p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/71630884/74416202.png" data-image-src="attachments/71630884/74416202.png" data-unresolved-comment-count="0" data-linked-resource-id="74416202" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-02-19 at 11.58.03 AM.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></p><p>Next up we will look at creating series data from the document.</p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">In this step</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Run translate script to create Doc</p><p>View Doc</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Windows users</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Use %RAPTURE_HOME% if needed</p></div></div></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h2 id="RaptureGettingStarted:Reflex-4.AnalyzeData–UpdateseriesDatafromdocuments">4. Analyze Data – Update series Data from documents</h2><p><span>Again in the same folder </span><span>$RAPTURE_HOME/Intro01/Reflex/src/main</span><span> run the script</span> DocToSeries.rfx:</p><div
        id="getcode"                style="color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;"              >
    <pre>$ ReflexRunner -f DocToSeries.rfx</pre>
</div>
<div class="confluence-information-macro confluence-information-macro-tip"><p class="title">Under the Hood</p><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><div id="expander-13729947" class="expand-container"><div id="expander-control-13729947" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Click here to see what&#39;s going on under the hood...</span></div><div id="expander-content-13729947" class="expand-content"><p>The data can be pulled from the Document Repository as a Map or read as a JSON String and converted to a Map using the fromjson operator:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">data &lt;-- DOC_URI+&quot;/introDataTranslated&quot;;
 
// or
 
docStr = #doc.getDoc(DOC_URI+&quot;/introDataTranslated&quot;);
data = fromjson(docStr);</pre>
</div></div><p>And of course the original list can be rebuilt</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">csv = [ ] ;
indexes = docMap.index_id;
for i in keys(indexes) do
  index = indexes[i];
  for prices in keys(index) do
    priceMap = index[prices];
    for dateVal in keys(priceMap) do
      row = [];
      row.add(docMap.series_type);
      row.add(docMap.provider);
      row.add(i);
      row.add(docMap.frequency);
      row.add(prices);
      row.add(dateVal);
      row.add(priceMap[dateVal]);
      csv.add(row);
    end
  end
end</pre>
</div></div><p>The data can also be written to a Series. If it is already in the correct format it can simply be pushed to the Series repository:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">csv --&gt; SERIES_URI;
// This is equivalent to
for line in csv.subList(1, size(csv)) do
   location = SERIES_URI;
   columns = size(line);
   if (columns &gt;= 2) do
     for field in line do
       if (columns == 1) do
         value = field;
       else if (columns == 2) do
         key = field;
       else do
         location = location+&quot;/&quot;+field;
       end
       columns = columns - 1;
     end
     #series.addDoubleToSeries(location, key, value);
   else do
     println(&quot;Line has less than 2 values: it will be skipped&quot;);
   end
end</pre>
</div></div></div></div></div></div><p> </p><p>At this point a a series has been created using data from <a href="document://tutorialDoc/introDataTranslated" rel="nofollow">document://tutorialDoc/introDataTranslated</a>.</p><p>Look at the <a href="https://github.com/Incapture/RaptureTutorials/blob/master/Intro01/Reflex/src/main/DocToSeries.rfx" class="external-link" rel="nofollow">DocToSeries.rfx</a>() in the RaptureTutorials project to see the API calls used.</p><p>Your data has now been stored in Rapture Information Manager in three forms: raw CSV, JSON document, and series data.</p><p>You can view the series on the RIM web interface.</p><p style="margin-left: 30.0px;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/71630884/74416203.png" data-image-src="attachments/71630884/74416203.png" data-unresolved-comment-count="0" data-linked-resource-id="74416203" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-02-19 at 12.02.16 PM.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></p><p>Next we will create a pdf from the series repository.</p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">In this step</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Run analyze script to create/update Series</p><p>View Series</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Windows users</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Use %RAPTURE_HOME% if needed</p></div></div></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h2 id="RaptureGettingStarted:Reflex-5.DistributeData–createreportsfromseriesData">5. Distribute Data – create reports from series Data</h2><p>This step will produce a pdf from the series data. The pdf is saved to your local directory and also the Rapture Instance.</p><div
        id="getcode"                style="color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;"              >
    <pre>$ cd $RAPTURE_HOME/Intro01/Java/ReportApp/build/install/ReportApp/bin</pre><div><pre>$ <span>./ReportApp</span></pre></div>
</div>
<p> </p><p>Look at the ReportApp <a class="external-link" href="https://github.com/Incapture/RaptureTutorials/blob/master/Intro01/Java/ReportApp/src/main/java/rapture/tutorial/ReportApp.java" rel="nofollow">code</a> in RaptureTutorials project.</p><p>You can look at the pdf on the RIM interface at this url <strong><a href="blob://tutorialBlob/output.pdf" rel="nofollow">blob://tutorialBlob/output.pdf</a></strong></p><p style="margin-left: 30.0px;"><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/71630884/74416175.png" data-image-src="attachments/71630884/74416175.png" data-unresolved-comment-count="0" data-linked-resource-id="74416175" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screen Shot 2016-02-19 at 12.04.28 PM.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="53"></span></span></strong></p><div><strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><br/></span></strong></div></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><div class="confluence-information-macro confluence-information-macro-information"><p class="title">In this step</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Run report step to create PDF</p><p>View PDF and Blob</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><p class="title">Windows users</p><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>A batch file is provided: Report.bat</p><p>Use %RAPTURE_HOME% if needed</p></div></div></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p><p><u><strong><br/></strong></u></p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr/><h2 id="RaptureGettingStarted:Reflex-6.ResetData(Optional)">6. Reset Data (Optional)</h2><p> </p><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Reset data</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Follow these steps to reset your demo environment.</p><ol><li>Using RIM, go to Scripts/Tutorial01/tutorialCleanup.rfx and click open.</li><li>Execute the script using the &quot;Run Script&quot; button</li></ol></div></div></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr/><p> </p></div>
</div>
</div>
</div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630863.docx">ReflexDemo.docx</a> (application/vnd.openxmlformats-officedocument.wordprocessingml.document)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630864.zip">RCMDemo.zip</a> (application/zip)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630865.zip">ReflexRunner.zip</a> (application/zip)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630866.png">image2016-1-15 15:31:19.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630867.png">image2016-1-15 15:31:1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630868.png">image2016-1-14 10:34:23.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630869.png">image2016-1-14 10:32:12.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630870.png">image2016-1-14 10:31:43.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630871.png">image2016-1-14 10:31:18.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630872.pdf">Reflex Language Reference_v1pt10.pdf</a> (application/pdf)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630873.png">image2016-1-8 9:31:40.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630874.png">image2016-1-8 9:31:14.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630875.png">image2016-1-7 16:3:41.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630876.png">image2016-1-7 16:3:16.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630877.png">image2016-1-7 16:2:30.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630878.png">image2015-6-16 12:50:33.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630879.png">image2015-6-16 12:52:48.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630880.png">image2015-6-16 12:54:26.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630881.png">resultPrintHello.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630882.png">initial.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71630883.png">step4result.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71631030.png">image2016-2-4 13:40:21.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/71631046.png">image2016-2-4 17:22:5.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/74416148.png">Screen Shot 2016-02-05 at 11.19.16 AM.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/74416175.png">Screen Shot 2016-02-19 at 12.04.28 PM.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/74416199.png">Screen Shot 2016-02-19 at 11.52.32 AM.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/74416202.png">Screen Shot 2016-02-19 at 11.58.03 AM.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/71630884/74416203.png">Screen Shot 2016-02-19 at 12.02.16 PM.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>


                </div>             </div>
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 26, 2016 13:54</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
