<!DOCTYPE html>
<!-- saved from url=(0090)https://incapture.atlassian.net/wiki/plugins/viewsource/viewpagesrc.action?pageId=71630884 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>View Source</title>
        <link rel="canonical" href="https://incapture.atlassian.net/wiki/pages/viewpage.action?pageId=$action.page.id">
        <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/wiki\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:/wiki(?:/s/.*?/_)?/download|//d1ixbz5qgnvms3\\\\.cloudfront\\\\.net/incapture\\\\.atlassian\\\\.net/wiki(?:/s/.*?/_)?/download)\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script>
<link type="text/css" rel="stylesheet" href="./Tutorial_REFLEX_files/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="//d1ixbz5qgnvms3.cloudfront.net/incapture.atlassian.net/wiki/s/000a09a525c066bad12450ab87d749eb-CDN/en_GB/6428/2ea41027c91142646414d0fb5d19218adf96fb83/f6fc99cd925974d8fcaaa74d4e8c1f41/_/download/contextbatch/css/_super/batch.css?atlassian.aui.raphael.disabled=true&amp;conditionalComment=lt+IE+9&amp;jquery.external=true&amp;relative-url=true"  media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="//d1ixbz5qgnvms3.cloudfront.net/incapture.atlassian.net/wiki/s/000a09a525c066bad12450ab87d749eb-CDN/en_GB/6428/2ea41027c91142646414d0fb5d19218adf96fb83/f6fc99cd925974d8fcaaa74d4e8c1f41/_/download/contextbatch/css/_super/batch.css?atlassian.aui.raphael.disabled=true&amp;conditionalComment=lte+IE+9&amp;jquery.external=true&amp;relative-url=true"  media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="./Tutorial_REFLEX_files/batch(1).css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial_REFLEX_files/batch(2).css" media="all">
<link type="text/css" rel="stylesheet" href="./Tutorial_REFLEX_files/batch(3).css" media="all">
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="//d1ixbz5qgnvms3.cloudfront.net/incapture.atlassian.net/wiki/s/ab37dc21819eccdc9e77d6fc35522331-CDN/en_GB/6428/2ea41027c91142646414d0fb5d19218adf96fb83/24652ae65cfb418cb7fc33f6ce4ac990/_/download/contextbatch/css/editor-content,-_super/batch.css?conditionalComment=lte+IE+9&amp;confluence.view.edit.transition=true&amp;relative-url=true"  media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="./Tutorial_REFLEX_files/colors.css" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <div class="contentLayout2">
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr><h1>Tutorial 1: Your first Rapture Project. &nbsp;</h1><p>This tutorial will cover uploading files, translating into documents, updating series data, and running reports.&nbsp;<br>It will explain how to use the Rapture Scripting Language, REFLEX.</p><p>&nbsp;</p><h2><strong>Options for running Reflex</strong></h2><p>Running this tutorial requires access to a running Rapture instance. See&nbsp;<a href="http://rapture+getting+started+guide/#GetDemoEnv">Rapture Getting Started Guide</a></p><p>Reflex is a scripting language, and as such requires an interpreter. There are three ways to execute the scripts in this Reflex tutorial.</p><p>1) RIM demo environment: Reflex REPL window.</p><p>There is an interpreter built into the web interface - login and click on the &gt;_ icon.&nbsp;This will bring up the Reflex REPL window; users can type commands directly into the browser and they will be executed immediately.</p><p>&nbsp;</p><p><img class="confluence-embedded-image" src="./Tutorial_REFLEX_files/image2016-2-4 17-22-5.png" data-image-src="/wiki/download/attachments/71630884/image2016-2-4%2017%3A22%3A5.png?version=1&amp;modificationDate=1454635325098&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="71631046" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2016-2-4 17:22:5.png" data-base-url="https://incapture.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="71630884" data-linked-resource-container-version="25" title="PRODUCT &gt; Rapture Getting Started: REFLEX &gt; image2016-2-4 17:22:5.png" data-location="PRODUCT &gt; Rapture Getting Started: REFLEX &gt; image2016-2-4 17:22:5.png" data-image-height="251" data-image-width="1019"></p><p>&nbsp;</p><p>2) RIM demo environment: Script execution UI.</p><p><strong><span style="color: rgb(255,0,0);">TBD if this will be ready: see&nbsp;</span></strong><a class="issue-link" href="https://incapture.atlassian.net/browse/RCM-197">RCM-197</a>.</p><p>3) Local: ReflexRunner client utility&nbsp;</p><p>The tutorial bundle includes ReflexRunner, a Java interpreter that will read and execute a reflex script from a file. This document will focus on running the tutorial scripts using ReflexRunner, but will also note any differences between this and the REPL window.&nbsp;</p><p><em>Connecting to Rapture</em>:&nbsp;To log in to the Rapture environment via ReflexRunner the user must specify a user name, a password and the location (URL) of the Rapture instance to connect to. This can be done using command line options or environmental variables.</p><p>The tutorial includes a script called&nbsp;<span style="color: rgb(44,45,48);">Intro01/</span>raptureSetup.sh -&nbsp;<strong>if this script has already been executed then the following environmental variables will have been set and the command line options will not be needed</strong>. For reference:</p><p style="margin-left: 30.0px;">The environment can be specified using the -r option, or by setting the RAPTURE_HOME environmental variable. In most cases this will take the form http://<strong><em>envname</em></strong>.<a href="http://incapture.net/">incapture.net</a>:8665/rapture</p><p style="margin-left: 30.0px;">The username can be entered manually or specified with the -u option, or by setting the&nbsp;RAPTURE_USER environmental variable. Typically all users will have their own personal accounts; there is also a common 'rapture' account.</p><p style="margin-left: 30.0px;">The password can also be&nbsp;entered manually or specified with the -p option, or by setting the&nbsp;RAPTURE_PASSWORD environmental variable. Obviously in a real world instance for security purposes manual entry is recommended, but for the purposes of a tutorial this is supported.</p><p><em>Executing a script</em>:&nbsp;The script must be specified using the -f option; there is no command line or environmental alternative. So to run the App.rfx script using the default options:</p><pre>$ ReflexRunner -f App.rfx</pre></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p><p>&nbsp;</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="6ef462f6-0d17-4f06-b8fb-4b62877741a4" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Before beginning this demonstration of Rapture it is expected that your environment satisfies the following pre-requisites</p><ol><li>Java 8 (or later) runtime is installed and accessible<br><br></li></ol></td></tr></tbody></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="7c88df74-e735-4396-8e16-10a291ac8d86" data-macro-parameters="title=Reflex" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2luZm86dGl0bGU9UmVmbGV4fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Reflex is a scripting language developed at Incapture Technologies. It is designed for performing cloud-based data manipulation. Reflex takes very little resource overhead, and therefore handles the data interactions more efficiently than JRuby, Jython, or any other standard scripting tool. We will demonstrate how to perform various operations using Reflex; for those interested in learning more, please check out the&nbsp;<a class="confluence-link" href="https://incapture.atlassian.net/wiki/download/attachments/71630884/Reflex%20Language%20Reference_v1pt10.pdf?version=1&amp;modificationDate=1453918930264&amp;api=v2" data-linked-resource-container-id="71630884" data-linked-resource-container-version="25" data-linked-resource-content-type="application/pdf" data-linked-resource-id="71630872" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Reflex Language Reference_v1pt10.pdf" data-base-url="https://incapture.atlassian.net/wiki">Reflex Language Reference</a>. &nbsp;</p></td></tr></tbody></table></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr><h2>1.&nbsp;Create new&nbsp;Repositories&nbsp;to store the data.</h2><p>The script will first create the repositories that will be used for the remainder off the tutorial.&nbsp;</p><p>If a version of the tutorial has already been run, either Reflex, Java, Python or any other version, then these repositories may already exist.</p><p>The repositories can also be created using the web-based User Interface.</p><pre>&nbsp;</pre><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="b2e61629-f721-4bc4-ab28-d1b261ae431f" data-macro-parameters="theme=Eclipse" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGhlbWU9RWNsaXBzZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>SERIES_AUTHORITY="datacapture";
BLOB_AUTHORITY="tutorialBlob";
DOC_AUTHORITY="tutorialDoc";
BLOB_URI="blob://"+BLOB_AUTHORITY;
DOC_URI="document://"+DOC_AUTHORITY;
SERIES_URI="series://"+SERIES_AUTHORITY;
if (!#blob.blobRepoExists(BLOB_URI)) do
     #blob.createBlobRepo(BLOB_URI, "BLOB {} USING MONGODB {prefix=\""+BLOB_AUTHORITY+"\" }", "REP {} USING MONGODB { prefix=\""+BLOB_AUTHORITY+"\"}");
end
if (!#doc.docRepoExists(DOC_URI)) do
     #doc.createDocRepo(DOC_URI, "REP {} USING MONGODB {prefix=\""+DOC_AUTHORITY+"\"}");
end
if (!#series.seriesRepoExists(SERIES_URI)) do
     #series.createSeriesRepo(SERIES_URI, "SREP {} USING MONGODB {prefix=\""+SERIES_AUTHORITY+"\"}");
end</pre></td></tr></tbody></table></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p><p>&nbsp;</p><p style="text-align: right;">&nbsp;</p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr><h2>2. Capture Data&nbsp;– Load a CSV</h2><p>Run the script Upload.rfx:</p><table class="wysiwyg-macro" data-macro-name="div" data-macro-id="8fcded1c-3521-416b-98d6-b8cfd36de8d6" data-macro-parameters="id=getcode|style=color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2RpdjpzdHlsZT1jb2xvcjp3aGl0ZTtiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrO3BhZGRpbmc6MjBweDtib3JkZXI6d2hpdGU7Ym9yZGVyLWNvbG9yOiBncmF5O2JvcmRlci1yYWRpdXM6IDVweDt8aWQ9Z2V0Y29kZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>$ ReflexRunner -f Upload.rfx</pre></td></tr></tbody></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="541c9ebb-5a97-4d07-99ed-1d744d37dc32" data-macro-parameters="title=Under the Hood" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e3RpcDp0aXRsZT1VbmRlciB0aGUgSG9vZH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><table class="wysiwyg-macro" data-macro-name="expand" data-macro-id="77b4bfdd-ab95-42ae-b5db-845b9f5284e1" data-macro-parameters="title=Click here to see what&#39;s going on under the hood..." data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2V4cGFuZDp0aXRsZT1DbGljayBoZXJlIHRvIHNlZSB3aGF0J3MgZ29pbmcgb24gdW5kZXIgdGhlIGhvb2QuLi59&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>The script will attempt to read a data file and store it in the blob repository.&nbsp;<br>The accompanying data file&nbsp;<em><strong>introDataInbound.csv</strong></em>&nbsp;should be in the current working directory.&nbsp;</p><p>To read a different file, or to read from a different directory, set the environmental variable RAPTURE_TUTORIAL_CSV appropriately.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="4cb0a058-0d82-453f-96f2-d16b5779e55a" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>When using the REPL window or Script UI, Reflex cannot access the local file system. In order to upload data into Rapture a blob uploader is available from the user interface. To use this, create a Blob repository using the [+] icon at the top level if one does not already exist. Then select the repository using the Content Browser and select the [+] icon to upload a blob.</p></td></tr></tbody></table><p><span style="color: rgb(255,0,0);"><strong>TBD if Script UI will be ready.</strong></span></p><p>The following Reflex code defines a file with name CSV_FILE.&nbsp;<br>The file operation may take additional parameters to indicate the file type; these include&nbsp;</p><ul><li>CSV - Comma separated values. Each line is a series of values separated by a delimiter. The default delimiter is a comma; an alternate delimiter can be specified as a further argument. The data will be returned as a list of lists.</li><li>CSVHEADER -&nbsp;Comma separated values with separate header. In this case the first line is treated as a list of column headers and kept separate from the rest of the data. As with CSV a different delimiter can be specified. The data will be returned as a list of maps</li><li>JSONDOC - The data is a single JSON formatted document.&nbsp;The data will be returned as a single map.</li><li>JSONARRAY - The data is a list of JSON formatted documents, one per line.&nbsp;The data will be returned as a list of maps.</li></ul><p>Unrecognized data types will be stored with the mine-type text/plain.</p><p>The --&gt; operator, known as "push", takes the data from the file and inserts it directly into the Blob Repository.&nbsp;<br>The blob metadata will hold the type information as well as the time and identity of the uploader.&nbsp;</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="490d84c6-95ee-4bbd-8c66-9ca409a203db" data-macro-parameters="theme=Eclipse" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGhlbWU9RWNsaXBzZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>CSV_FILE = ENV.RAPTURE_TUTORIAL_CSV;

if (CSV_FILE == null) do
   CSV_FILE = "introDataInbound.csv";
   println("No CSV specified. Defaulting to "+CSV_FILE);
end
rawCsvUri = BLOB_URI+"/"+CSV_FILE;
if (!#blob.blobExists(rawCsvUri)) do
   println("Reading CSV from file " + CSV_FILE);
   file(CSV_FILE, "CSV") --&gt; rawCsvUri;
   println("CSV uploaded to "+ rawCsvUri);
else do
   println("Data has already been uploaded to the BLOB repository.");
end
println("\nDone\n");</pre></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><p>&nbsp;</p><p>&nbsp;</p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p><table class="wysiwyg-macro" data-macro-name="info" data-macro-id="f77da24e-7dce-44e9-8838-c6f1870ce7bd" data-macro-parameters="title=In this step" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2luZm86dGl0bGU9SW4gdGhpcyBzdGVwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Run upload script to load CSV into Blob</p><p>View Blob</p></td></tr></tbody></table></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr><h2>3. Translate Data&nbsp;– Create documents from raw Data</h2><p>Run the script BlobToDoc.rfx:</p><table class="wysiwyg-macro" data-macro-name="div" data-macro-id="8145006b-93b8-4191-a0e9-e8174e54d20a" data-macro-parameters="id=getcode|style=color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2RpdjpzdHlsZT1jb2xvcjp3aGl0ZTtiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrO3BhZGRpbmc6MjBweDtib3JkZXI6d2hpdGU7Ym9yZGVyLWNvbG9yOiBncmF5O2JvcmRlci1yYWRpdXM6IDVweDt8aWQ9Z2V0Y29kZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>$ ReflexRunner -f BlobToDoc.rfx</pre></td></tr></tbody></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="d854115e-e0a1-435c-9d95-fa1ac96cc8ea" data-macro-parameters="title=Under the Hood" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e3RpcDp0aXRsZT1VbmRlciB0aGUgSG9vZH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><table class="wysiwyg-macro" data-macro-name="expand" data-macro-id="91877974-3507-4fd3-891f-88ba0509cc99" data-macro-parameters="title=Click here to see what&#39;s going on under the hood..." data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2V4cGFuZDp0aXRsZT1DbGljayBoZXJlIHRvIHNlZSB3aGF0J3MgZ29pbmcgb24gdW5kZXIgdGhlIGhvb2QuLi59&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Having loaded the data into Rapture the next step is to convert it into a usable format.</p><p>One option is to use the Pull operator which will interpret the data according to its metadata type. In the case of a CSV, Reflex will split the data into a List of Lists.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="1943d652-e32a-47f4-9b1d-f4d4d0aaab52" data-macro-parameters="theme=Eclipse" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGhlbWU9RWNsaXBzZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>data &lt;-- rawCsvUri;</pre></td></tr></tbody></table><p>Another option is to open the blob using the file command and read it as raw text, one line at a time, then parse it accordingly. The split command will break each line into individual columns based on the separator string; the boolean argument indicates whether to ignore the separator if it occurs within quotation marks.</p><p>When using file to read a blob it is not necessary to specify the file type since this information is already stored as metadata. However the information can be supplied or overridden if so desired.&nbsp;</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="dd2b8725-873d-4d43-9b15-63cc58c5cfa8" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>data = [];
for datum in file(rawCsvUri) do
  if datum == null do
    println("Nothing found at " + rawCsvUri + ". Please run step 'upload' to add the CSV to Rapture.");
    // Reflex doesn't have an exit operation but assert(false) is the nearest thing.
    assert(false);
   end
   data.add(split(datum, ",", true));
end</pre></td></tr></tbody></table><p>Having read the data, process it. In this instance the last column needs to be converted from a string to a number using the cast operation, and the date column has hyphens which must be removed using the replace operation.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="2b614a90-1e13-4f35-8a8a-8ee87e503eba" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>headers = data[0];
noheaders = data.subList(1, data.size());
for datum in noheaders do
    siz = datum.size();
    if (siz &gt;= 2) do
      key = datum[siz -2];
      datum[siz -2] = replace(key,"-","");
      datum[siz -1] = cast(datum[siz -1], 'number');
  end
end</pre></td></tr></tbody></table><p>The data can now be written to the Document repository.&nbsp;In Rapture a Document must be a JSON formatted Map.</p><p>Since the data is in a List of Lists it will need to be converted to a Map.&nbsp;Pushing the List data to the Document repository will automatically convert the data&nbsp;to a nested Map of Maps - every unique entry in the first column will become a Key&nbsp;and the remaining columns will become values. The data can thereafter be pulled from the document repository as a Map.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="1c44f02d-9dd9-4ff3-bbea-59b1c852c63f" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>noheaders --&gt; DOC_URI+"/introDataTranslated";
&nbsp;</pre></td></tr></tbody></table><p>Alternatively the data can be written in an application-specific format, as long as it is a JSON compliant map. For this tutorial a format has been defined as described in the main document.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="965e75e2-32c7-49c9-b86d-f7b5ef9912e4" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>dataMap = {};
indexMap = {};
firstEntry = noheaders[0];
for k in [ 0,1,3 ] do
  key = headers[k];
  val = firstEntry[k];
  dataMap[key] = val;
end

key = headers[2];
dataMap[key] = indexMap;

for datum in noheaders do
  if (size(datum) &gt; 4) do
    index = datum[2];
    priceType = datum[4];
    indexValMap = indexMap[index];
    if (indexValMap == null) do
      indexValMap = {};
      indexMap[index] = indexValMap;
    end
    priceTypeMap = indexValMap[priceType];
    if (priceTypeMap == null) do
      priceTypeMap = {};
      indexValMap[priceType] = priceTypeMap;
    end
    datestr = datum[5];
    val = cast(datum[6], 'number');
    priceTypeMap[datestr] = val;
  end
end
#doc.putDoc(DOC_URI+"/introDataTranslated", json(dataMap));</pre></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<table class="wysiwyg-macro" data-macro-name="info" data-macro-id="44ac0efb-eb46-4d63-afc6-330cf4fb773d" data-macro-parameters="title=In this step" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2luZm86dGl0bGU9SW4gdGhpcyBzdGVwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Run translate script to create Doc</p><p>View Doc</p></td></tr></tbody></table></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr><h2>4. Analyze Data&nbsp;– Update series Data from documents</h2><p>Run the script DocToSeries.rfx:</p><p>&nbsp;</p><table class="wysiwyg-macro" data-macro-name="div" data-macro-id="2f1cb3fc-14d2-4cdd-a443-6c4ed4919acb" data-macro-parameters="id=getcode|style=color:white;background-color:black;padding:20px;border:white;border-color: gray;border-radius: 5px;" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2RpdjpzdHlsZT1jb2xvcjp3aGl0ZTtiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrO3BhZGRpbmc6MjBweDtib3JkZXI6d2hpdGU7Ym9yZGVyLWNvbG9yOiBncmF5O2JvcmRlci1yYWRpdXM6IDVweDt8aWQ9Z2V0Y29kZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>$ ReflexRunner -f DocToSeries.rfx</pre></td></tr></tbody></table><table class="wysiwyg-macro" data-macro-name="tip" data-macro-id="26de642f-a853-414b-8ad4-5a5f8b529996" data-macro-parameters="title=Under the Hood" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e3RpcDp0aXRsZT1VbmRlciB0aGUgSG9vZH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><table class="wysiwyg-macro" data-macro-name="expand" data-macro-id="42827eb2-8e70-479d-a73f-61defd042c00" data-macro-parameters="title=Click here to see what&#39;s going on under the hood..." data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2V4cGFuZDp0aXRsZT1DbGljayBoZXJlIHRvIHNlZSB3aGF0J3MgZ29pbmcgb24gdW5kZXIgdGhlIGhvb2QuLi59&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>The data can be pulled from the Document Repository as a Map or read as a JSON String and converted to a Map using the fromjson operator:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="58f054c1-971f-4eb3-8dae-c6f47e29302c" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>data &lt;-- DOC_URI+"/introDataTranslated";
&nbsp;
// or
&nbsp;
docStr = #doc.getDoc(DOC_URI+"/introDataTranslated");
data = fromjson(docStr);</pre></td></tr></tbody></table><p>And of course the original list can be rebuilt</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="9419ebcc-63cb-4a3f-8eaf-5acfaec4cb45" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>csv = [ ] ;
indexes = docMap.index_id;
for i in keys(indexes) do
  index = indexes[i];
  for prices in keys(index) do
    priceMap = index[prices];
    for dateVal in keys(priceMap) do
      row = [];
      row.add(docMap.series_type);
      row.add(docMap.provider);
      row.add(i);
      row.add(docMap.frequency);
      row.add(prices);
      row.add(dateVal);
      row.add(priceMap[dateVal]);
      csv.add(row);
    end
  end
end</pre></td></tr></tbody></table><p>The data can also be written to a Series. If it is already in the correct format it can simply be pushed to the Series repository:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="adbb6c21-9cb4-4b60-92d8-e197c8522c5d" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><pre>csv --&gt; SERIES_URI;
// This is equivalent to
for line in csv.subList(1, size(csv)) do
   location = SERIES_URI;
   columns = size(line);
   if (columns &gt;= 2) do
     for field in line do
       if (columns == 1) do
         value = field;
       else if (columns == 2) do
         key = field;
       else do
         location = location+"/"+field;
       end
       columns = columns - 1;
     end
     #series.addDoubleToSeries(location, key, value);
   else do
     println("Line has less than 2 values: it will be skipped");
   end
end</pre></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table><p>&nbsp;</p><p>&nbsp;</p></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<table class="wysiwyg-macro" data-macro-name="info" data-macro-id="cbbdecaf-2252-4331-92fd-def24ad792c7" data-macro-parameters="title=In this step" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e2luZm86dGl0bGU9SW4gdGhpcyBzdGVwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Run analyze script to create/update Series</p><p>View Series</p></td></tr></tbody></table></div>
</div>
</div>
<div class="columnLayout three-with-sidebars" data-layout="three-with-sidebars">
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p><p><u><strong><br></strong></u></p></div>
</div>
<div class="cell normal" data-type="normal">
<div class="innerCell">
<hr><h2>5. Reset Data (Optional)</h2><p>&nbsp;</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-id="fe8c084e-21fb-4fb1-a5b4-91d7ac820bf1" data-macro-parameters="title=Reset data" data-macro-schema-version="1" style="background-image: url(/wiki/plugins/servlet/confluence/placeholder/macro-heading?definition=e25vdGU6dGl0bGU9UmVzZXQgZGF0YX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tbody><tr><td class="wysiwyg-macro-body"><p>Follow these steps to reset your demo environment.</p><ol><li>Using RIM, go to Scripts/Tutorial01/tutorialCleanup.rfx and click open.</li><li>Execute the script using the "Run Script" button</li></ol></td></tr></tbody></table></div>
</div>
<div class="cell sidebars" data-type="sidebars">
<div class="innerCell">
<hr><p>&nbsp;</p></div>
</div>
</div>
</div>
        <p>&nbsp;</p>
    

</body></html>